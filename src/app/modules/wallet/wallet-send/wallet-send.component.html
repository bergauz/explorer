<div class="wallet-send">
  <div class="f f-j--c p-b--20">
    <div class="card">
      <h4>Open wallet</h4>
      <div class="card__content">
        <form [formGroup]="privateKeyForm">
          <div class="uk-margin">
            <label class="uk-form-label">Enter your private key to perform operations.</label>
            <div class="uk-form-controls">
              <!--<div class="uk-inline">
                <span class="uk-form-icon uk-form-icon-flip"><i class="fas fa-eye"></i></span>-->
              <input class="uk-input" type="password" placeholder="Private Key" formControlName="privateKey" autofocus>
              <!--</div>-->
            </div>
          </div>
        </form>
        <div class="wallet-send__balance" *ngIf="balance != null && balance !=''">
          <!--<p>Address for key: {{address}}</p>-->
          <span>Balance: {{balance | number}}</span>
          <!--<p><a routerLink="/addr/{{address}}">View address</a></p>-->
          <!--<div class="center">
            <button type="button" class="btn btn&#45;&#45;sm btn&#45;&#45;round" (click)="closeWallet()">Close wallet</button>
          </div>-->
        </div>
        <div class="m-t--20 ta-r">
          <button routerLink="/wallet" type="button" class="btn btn--light m-r--20">Back</button>
          <button type="submit" class="btn" (click)="onPrivateKeySubmit()">
            <ng-container *ngIf="!isOpening; else opening;">
              Open
            </ng-container>
            <ng-template #opening>
              Opening <i class="fas fa-spinner fa-spin m-l--10"></i>
            </ng-template>
          </button>
        </div>
      </div>
      <!--<div class="uk-margin" *ngIf="balance == null || balance ==''">
        <p>Address for key: {{address}}</p>
        <p>Your current balance is: <span style="font-weight: bold; color: greenyellow;">{{balance | number}}</span></p>
        <p><a routerLink="/addr/{{address}}">View address</a></p>
        <div class="center">
          <button type="button" class="btn btn&#45;&#45;sm btn&#45;&#45;round" (click)="closeWallet()">Close wallet</button>
        </div>
      </div>-->
    </div>
  </div>
  <div class="wallet-send__tabs-bg">
    <div class="wallet-send__tabs" *ngIf="balance != null && balance !=''">
      <app-tabs name="send_tx_tab" class="wallet" (onChangeEmitter)="onTabChange($event)">
        <tab name="send_go" title="Send GO">
          <tab-content [hidden]="isProcessing">
            <div class="form-card">
              <h5>Perform a regular transaction, send GO to another account</h5>
              <form [formGroup]="sendGoForm">
                <div class="uk-margin">
                  <label class="uk-form-label">To*:</label>
                  <div class="uk-form-controls">
                    <input class="uk-input" type="text" placeholder="To" formControlName="to">
                  </div>
                </div>
                <div class="bottom-form-block">
                  <div class="uk-margin">
                    <label class="uk-form-label">Amount*:</label>
                    <div class="uk-form-controls">
                      <input class="uk-input uk-form-width-medium" type="text" placeholder="Amount" formControlName="amount">
                    </div>
                  </div>
                  <div class="m-l--50">
                    <label class="uk-form-label">Gas Limit*:</label>
                    <div class="uk-form-controls">
                      <input class="uk-input uk-form-width-medium" placeholder="Gas Limit" formControlName="gasLimit"
                             type="number">
                    </div>
                  </div>
                </div>
                <div class="m-t--80 f f-j--sb">
                  <button class="btn" type="submit" (click)="sendGo()" [disabled]="isProcessing">Send</button>
                  <button class="btn btn--default btn--light m-r--10" type="reset" [disabled]="isProcessing">Reset</button>
                </div>
              </form>
            </div>
          </tab-content>
        </tab>
        <tab name="deploy_contract" title="Deploy Contract">
          <tab-content [hidden]="isProcessing">
            <div class="form-card rm-card">
              <h5>Deploy a Smart Contract to GoChain</h5>
              <form class="uk-form-horizontal" [formGroup]="deployContractForm">
                <div class="uk-margin">
                  <label>Bytecode*:</label>
                  <div>
                <textarea class="uk-textarea" rows="5" formControlName="byteCode"
                          placeholder="Bytecode"></textarea>
                    <p>Must start with 0x!</p>
                  </div>
                </div>
                <div class="uk-margin">
                  <label class="uk-form-label">Gas Limit*:</label>
                  <div class="uk-form-controls">
                    <input class="uk-input uk-form-width-medium" placeholder="Gas Limit" formControlName="gasLimit"
                           type="number">
                  </div>
                </div>
                <div class="uk-margin f f-j--sb">
                  <button class="btn" type="submit" (click)="deployContract()" [disabled]="isProcessing">Deploy</button>
                  <button class="btn btn--default btn--light m-r--10" type="reset" [disabled]="isProcessing">Reset</button>
                </div>
              </form>
            </div>
          </tab-content>
        </tab>
        <tab name="use_contract" title="Use Contract">
          <tab-content [hidden]="isProcessing">
            <div class="form-card">
              <h5>Interact with a Smart Contract on GoChain</h5>
              <form  [formGroup]="useContractForm">
                <div class="uk-margin">
                  <label class="uk-form-label">Contract Address*:</label>
                  <div>
                    <input class="uk-input" placeholder="Contract Address" formControlName="contractAddress">
                  </div>
                </div>
                <div class="uk-margin">
                  <label class="uk-form-label">ABI / JSON Interface:</label>
                  <div>
                <textarea class="uk-textarea" placeholder="ABI / JSON Interface" formControlName="contractABI"
                          rows="5"></textarea>
                  </div>
                </div>
                <ng-container *ngIf="contract != null" >
                  <div class="uk-margin">
                    <label class="uk-form-label">Choose Contract Function</label>
                    <div class="uk-form-controls">
                      <select class="uk-select" id="contractFunction" formControlName="contractFunction">
                        <option *ngFor="let selectableFunction of funcsToSelect(); let index = index;" [value]="index">
                          {{selectableFunction.name}}
                          - {{selectableFunction.payable || !selectableFunction.constant ? '$' : 'free'}}
                        </option>
                      </select>
                      <i class="fas fa-caret-down"></i>
                    </div>
                  </div>
                  <ng-container *ngIf="selectedFunction">
                    <div *ngFor="let functionInput of selectedFunction.inputs; let i=index" formArrayName="functionParameters"
                         class="uk-margin">
                      <div class="uk-form-controls">
                        <input class="uk-input" placeholder="{{functionInput.name}}" formControlName="{{i}}">
                      </div>
                    </div>
                    <div *ngIf="selectedFunction.payable" class="uk-margin">
                      <div class="uk-form-controls">
                        <input class="uk-input" placeholder="Amount" formControlName="contractAmount">
                      </div>
                    </div>
                    <div *ngIf="!selectedFunction.constant || selectedFunction.payable" class="uk-margin">
                      <label class="uk-form-label">Gas Limit*:</label>
                      <div class="uk-form-controls">
                        <input class="uk-input uk-form-width-medium" placeholder="Gas Limit" formControlName="gasLimit"
                               type="number">
                      </div>
                    </div>
                  </ng-container>
                </ng-container>
                <div *ngIf="functionResult">
                  <h4 style="color: #02F48E !important">Response</h4>
                  <div *ngFor="let k of functionResult" style="color: #02F48E !important">
                    {{k[0]}}: <span style="font-weight: bold; color: #02F48E !important">{{k[1]}}</span>
                  </div>
                </div>
                <div class="uk-margin f f-j--sb">
                  <button class="btn" type="submit" (click)="useContract()" [disabled]="isProcessing">Submit</button>
                  <button class="btn btn--default btn--light m-r--10" type="reset" [disabled]="isProcessing">Reset</button>
                </div>
              </form>
            </div>
          </tab-content>
        </tab>
      </app-tabs>
      <ng-container *ngIf="isProcessing">
        <div *ngIf="!receipt; else result;" class="processing">
          <div class="processing__icon">
            <i class="fas fa-spinner fa-spin"></i>
          </div>
          <div class="processing__content">
            Transaction submitted, waiting for receipt...
          </div>
        </div>
        <ng-template #result>
          <div class="receipt">
            <div class="receipt__header">
              Transaction complete!
            </div>
            <div class="receipt__content">
              <ul>
                <li>
                  <p>Transaction Hash:</p>
                  <b><a routerLink="/tx/{{receipt.transactionHash}}" target="_blank">{{receipt.transactionHash}}</a></b>
                </li>
                <li>
                  <p>Block Hash:</p>
                  <b><a routerLink="/block/{{receipt.blockHash}}" target="_blank">{{receipt.blockHash}}</a></b>
                </li>
                <li *ngIf="receipt.contractAddress">
                  <p>Contract Address:</p>
                  <b><a routerLink="/address/{{ receipt.contractAddress}}" target="_blank">{{ receipt.contractAddress }}</a></b>
                </li>
                <li>
                  <p>Gas Used:</p>
                  <b>{{receipt.gasUsed}}</b>
                </li>
              </ul>
            </div>
            <div class="receipt__footer">
              <button (click)="resetProcessing()" class="btn btn--sm btn--round">Cancel</button>
            </div>
          </div>
        </ng-template>
      </ng-container>
    </div>
  </div>
</div>